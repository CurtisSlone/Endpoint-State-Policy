# ICS file designed to pass Pass 1-4 but fail Pass 5 semantic analysis
# This file contains valid syntax, symbols, and references but semantic violations

META
version `1.0.0`
author `test-author`
description `Semantic analysis test file with intentional violations`
META_END

DEF

# Valid variables
VAR base_path string `C:\Windows`
VAR threshold int 100

# Valid global states
STATE valid_state
    name string = `test_value`
    size int > VAR threshold
STATE_END

STATE another_state
    path string contains `system`
    count int <= 50
STATE_END

# SEMANTIC VIOLATION 1: Type incompatibility - using string operation on int field
STATE type_violation_state
    file_size int contains `large`
STATE_END

# SEMANTIC VIOLATION 2: Pattern matching on boolean type
STATE pattern_violation_state
    is_enabled boolean pattern_match `^true`
STATE_END

# Valid global object
OBJECT test_object
    path VAR base_path
    filename `config.ini`
OBJECT_END

# SEMANTIC VIOLATION 3: Runtime operation type error - CONCAT with int input
RUN concat_result CONCAT
    VAR threshold
    literal `_suffix`
RUN_END

# SEMANTIC VIOLATION 4: SET operation constraint violation - intersection with only 1 operand
SET bad_intersection intersection
    OBJECT_REF test_object
SET_END

# Valid criteria to pass earlier passes
CRI AND
CTN registry_check
    TEST any all
    STATE_REF valid_state
    OBJECT_REF test_object
CTN_END

CTN file_check
    TEST all all
    STATE_REF another_state
    STATE local_state
        local_field string = `local_value`
    STATE_END
CTN_END
CRI_END

DEF_END
