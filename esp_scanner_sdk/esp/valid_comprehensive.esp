# Complex but valid ICS file demonstrating all features
META
version `2.1.0`
ics_version `1.0`
author `test-suite`
date `2024-01-15`
severity `medium`
platform `multi`
description `Comprehensive valid ICS file showcasing all features`
compliance_framework `ISO-27001`
tags `comprehensive,validation,test`
META_END

DEF
# Variables with different types and dependencies
VAR base_path string `C:\Program Files\Application`
VAR config_path string `/etc/home`
VAR port_number_string string `8080`
VAR port_number_int int 8080
VAR timeout_seconds string `30.5`
VAR debug_enabled boolean false
VAR version_string string `2.1.0`
VAR package_info evr_string `1:2.1.0-1.el8`

# Runtime operations demonstrating various types
RUN full_config_path CONCAT
    VAR config_path
    literal `\config.xml`
RUN_END

RUN log_entry CONCAT
    literal `Application starting on port `
    VAR port_number_string
    literal ` with timeout `
    VAR timeout_seconds
    literal ` seconds`
RUN_END

RUN version_parts SPLIT
    VAR version_string
    delimiter `.`
RUN_END

RUN debug_string SUBSTRING
    literal `Debug mode is currently active for development`
    start 0
    length 20
RUN_END

RUN port_calculation ARITHMETIC
    VAR port_number_int
    + 1000
    * 2
RUN_END

# Global states with various field types and operations
STATE application_config
    config_file string = VAR full_config_path
    port int = VAR port_number_int
    timeout float >= VAR timeout_seconds
    debug_mode boolean = VAR debug_enabled
    version version > `1.0.0`
    package_version evr_string = VAR package_info
STATE_END

STATE security_settings
    ssl_enabled boolean = true
    cert_path string contains `certificate`
    key_path string starts `/etc/ssl`
    cipher_suite string pattern_match `^TLS`
    min_version version >= `1.2`
STATE_END

STATE file_permissions
    config_readable boolean = true
    log_writable boolean = true
    backup_path string ends `.bak`
    owner_permissions string ieq `rwx`
    group_permissions string ine `rwx`
STATE_END

# Global objects with different element types
OBJECT web_server
    module_name `nginx`
    verb `configure`
    noun `server`
    config_file VAR full_config_path
    port VAR port_number_int

    parameters record_data
        ServerName `localhost`
        DocumentRoot `/var/www/html`
        ErrorLog `/var/log/error.log`
        CustomLog `/var/log/access.log`
        MaxClients `150`
    parameters_end

    select string
        ServerStatus `active`
        ProcessID `pid`
        Memory `memory_usage`
    select_end

    behavior max_connections 1000
    behavior timeout_seconds 30
OBJECT_END

OBJECT database_config
    type `postgresql`
    host `localhost`
    port 5432

    FILTER include
        STATE_REF security_settings
    FILTER_END
OBJECT_END

# Set operations demonstrating all types
SET web_components union
    OBJECT_REF web_server
    OBJECT_REF database_config
SET_END

SET secure_components intersection
    SET_REF web_components
    OBJECT inline_security
        security_level `high`
        encryption `AES256`
    OBJECT_END
SET_END

SET filtered_components complement
    SET_REF web_components
    SET_REF secure_components
    FILTER include
        STATE_REF security_settings
    FILTER_END
SET_END

# Complex criteria structure with multiple levels
CRI AND
    # First criterion with external references and local elements
    CTN application_startup
        TEST all all
        STATE_REF application_config
        STATE_REF security_settings
        OBJECT_REF web_server

        STATE local_startup_state
            startup_time float <= 10.0
            memory_usage int < 1000000
            process_count int = 1
        STATE_END

        OBJECT local_monitoring
            monitor_type `startup`
            check_interval 5
            alert_threshold 15
        OBJECT_END
    CTN_END

    # Nested criteria demonstrating complex logic
    CRI OR
        CTN security_check
            TEST at_least_one all
            STATE_REF security_settings
            STATE_REF file_permissions

            STATE local_security_audit
                last_audit_date string >= `2024-01-01`
                compliance_score int > 85
                vulnerabilities int = 0
            STATE_END
        CTN_END

        CRI AND
            CTN backup_verification
                TEST all all
                STATE local_backup_status
                    backup_enabled boolean = true
                    last_backup_date string >= `2024-01-01`
                    backup_size int > 0
                    backup_integrity boolean = true
                STATE_END
            CTN_END

            CTN monitoring_verification
                TEST all all AND
                STATE local_monitoring_state
                    alerts_enabled boolean = true
                    log_level string ieq `INFO`
                    retention_days int >= 30
                STATE_END
            CTN_END
        CRI_END
    CRI_END

    # Final criterion with set references
    CTN component_validation
        TEST any all
        OBJECT set_validation
            SET_REF secure_components
        OBJECT_END

        STATE component_health
            all_services_running boolean = true
            error_count int = 0
            response_time float < 5.0
        STATE_END
    CTN_END
CRI_END
DEF_END
