META
    version `1.0.0`
    esp_version `1.0`
    author `test-suite`
    date `2025-11-04`
    severity `medium`
    platform `linux`
    description `Comprehensive RUN operations validation test`
    control_framework `TEST`
    control `RUN-OPS-001`
    esp_scan_id `run-operations-test`
    criticality `low`
    tags `testing,run-operations,string-ops,arithmetic`
META_END

DEF
    VAR test_string string `Hello World from ESP`
    VAR path_string string `/usr/bin:/opt/bin:/home/user/bin`
    VAR log_line string `[2025-11-04 14:30:22] ERROR: Connection failed to 192.168.1.100`
    VAR csv_data string `apple,banana,cherry,banana,apple,date`
    VAR base_number int 100
    VAR multiplier int 3

    RUN full_greeting CONCAT
        VAR test_string
        literal ` - Testing RUN operations`
    RUN_END

    RUN path_list SPLIT
        VAR path_string
        delimiter `:`
    RUN_END

    RUN csv_items SPLIT
        VAR csv_data
        delimiter `,`
    RUN_END

    RUN path_count COUNT
        VAR path_list
    RUN_END

    RUN item_count COUNT
        VAR csv_items
    RUN_END

    RUN unique_items UNIQUE
        VAR csv_items
    RUN_END

    RUN unique_count COUNT
        VAR unique_items
    RUN_END

    RUN greeting_only SUBSTRING
        VAR test_string
        start 0
        length 5
    RUN_END

    RUN world_only SUBSTRING
        VAR test_string
        start 6
        length 5
    RUN_END

    RUN last_word SUBSTRING
        VAR test_string
        start -3
        length 3
    RUN_END

    RUN timestamp_capture REGEX_CAPTURE
        VAR log_line
        pattern `\[(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\]`
    RUN_END

    RUN ip_address_capture REGEX_CAPTURE
        VAR log_line
        pattern `(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})`
    RUN_END

    RUN calculated_value ARITHMETIC
        VAR base_number
        + 50
        * VAR multiplier
        / 2
    RUN_END

    RUN simple_sum ARITHMETIC
        VAR base_number
        + 100
    RUN_END

    RUN all_items MERGE
        VAR path_list
        VAR csv_items
    RUN_END

    RUN merged_count COUNT
        VAR all_items
    RUN_END

    RUN last_path END
        VAR path_list
    RUN_END

    RUN last_item END
        VAR csv_items
    RUN_END

    OBJECT validation_test
        type `test`
        description `RUN operations validation`
    OBJECT_END

    STATE test_string_operations
        full_greeting string contains `Testing RUN operations`
        greeting_only string = `Hello`
        world_only string = `World`
        last_word string = `ESP`
        last_path string = `/home/user/bin`
        last_item string = `date`
    STATE_END

    STATE test_numeric_operations
        path_count int = 3
        item_count int = 6
        unique_count int = 4
        calculated_value int = 225
        simple_sum int = 200
        merged_count int = 9
    STATE_END

    CRI AND
        CTN computed_values
            TEST all all
            STATE_REF test_string_operations
            STATE_REF test_numeric_operations
            OBJECT_REF validation_test
        CTN_END
    CRI_END
DEF_END
