META
    version `1.0.0`
    esp_version `1.0`
    author `security-team`
    date `2024-01-15`
    severity `high`
    platform `linux`
    description `Entity check validation test with JSON records`
    control_framework `NIST`
    control `AC-2.4`
    esp_scan_id `entity-check-test`
    criticality `high`
    tags `linux, file_content,file_metadata`
META_END


DEF
VAR test_json_path string `scanfiles/test_data.json`

# Test 1: Direct path (no wildcard) - should work
STATE test_direct
    record record_data
        field config.version string = `2.1.0`
    record_end
STATE_END

# Test 2: Simple wildcard - users.*.username
STATE test_simple_wildcard
    record record_data
        field users.*.username string contains `admin` at_least_one
    record_end
STATE_END

# Test 3: Wildcard with boolean
STATE test_wildcard_boolean
    record record_data
        field users.*.active boolean = true all
    record_end
STATE_END

OBJECT json_data_file
    path VAR test_json_path
OBJECT_END

CRI AND
    CTN json_record
        TEST all all
        OBJECT_REF json_data_file
        STATE_REF test_direct
    CTN_END

    CTN json_record
        TEST all all
        OBJECT_REF json_data_file
        STATE_REF test_simple_wildcard
    CTN_END

    CTN json_record
        TEST all all
        OBJECT_REF json_data_file
        STATE_REF test_wildcard_boolean
    CTN_END
CRI_END

DEF_END
